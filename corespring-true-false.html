<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../paper-styles/typography.html" />
<link rel="import" href="../paper-radio-button/paper-radio-button.html" />
<link rel="import" href="../corespring-show-correct-answer-toggle/corespring-show-correct-answer-toggle.html" />
<!-- 
`corespring-true-false` is a component that contains a prompt + 2 radio buttons: true and false. 


  ## Styling 


  Name | description | default 
  -----|-------------|--------
  `--true-false-color` | ? | ? 
  `--true-false-correct-color` | ? | ? 
  `--true-false-incorrect-color` | ? | ? 

@demo demo/index.html
-->
<dom-module id="corespring-true-false">
  <template>
    <style>

    :host{
      @apply(--paper-font-common-base);
      color: var(--true-false-prompt-color, black);
    }

    :host paper-radio-button {
      padding-left: 10px;
      --paper-radio-button-checked-color: var(--true-false-color, --paper-indigo-500);
      --paper-radio-button-checked-ink-color: var(--true-false-color,--paper-indigo-500);
      --paper-radio-button-unchecked-color: var(--true-false-color, --paper-indigo-500);
      --paper-radio-button-unchecked-ink-color: var(--true-false-color,--paper-indigo-500);
      --paper-radio-button-label-color: var(--true-false-color, --paper-indigo-500);
    }

    paper-radio-button.correct {
      --paper-radio-button-checked-color: var(--true-false-correct-color, --paper-green-500);
      --paper-radio-button-unchecked-color: var(--true-false-correct-color, --paper-green-500);
      --paper-radio-button-checked-ink-color: var(--true-false-correct-color,--paper-green-500);
      --paper-radio-button-unchecked-ink-color: var(--true-false-correct-color,--paper-green-500);
      --paper-radio-button-label-color: var(--true-false-correct-color, --paper-green-500);
    }

    paper-radio-button.incorrect {
      --paper-radio-button-checked-color: var(--true-false-incorrect-color, --paper-red-500);
      --paper-radio-button-unchecked-color: var(--true-false-incorrect-color, --paper-red-500);
      --paper-radio-button-checked-ink-color: var(--true-false-incorrect-color, --paper-red-500);
      --paper-radio-button-unchecked-ink-color: var(--true-false-incorrect-color, --paper-red-500);
      --paper-radio-button-label-color: var(--true-false-incorrect-color, --paper-red-500);
    }

    .holder{
      height: 25px;
    }

    corespring-show-correct-answer-toggle{
      display: inline-block;
      vertical-align: middle;
      padding-left: 10px;
      --show-correct-answer-height: 25px;
      @apply(--paper-font-common-base);
    }

    </style>
    <div class="holder">
      <span>{{prompt}}</span>
      <paper-radio-button 
        id="true-button"
        on-change="_onTrueChanged"
        class$="{{_trueClass(_viewModel.selected, _viewModel.correctness)}}" 
        disabled="{{disabled}}"
        noink 
        >true</paper-radio-button>
      <paper-radio-button 
        id="false-button"
        disabled="{{disabled}}"
        class$="{{_falseClass(_viewModel.selected, _viewModel.correctness)}}" 
        on-change="_onFalseChanged"
        noink 
        name="false" 
      >false</paper-radio-button>
      <template is="dom-if" if="{{correctResponse}}">
          <corespring-show-correct-answer-toggle on-toggle="_toggleShowCorrectResponse"></corespring-show-correct-answer-toggle>
      </template>
    </div>
  </template>
</dom-module>
<script>

  Polymer({
    is: 'corespring-true-false',
    properties: {
      disabled: {type: Boolean},
      prompt: {type:String},
      correctResponse: {type:Object},
      correctness: {type: String, value: null, observer: '_onCorrectnessChange'},
      selection: {type:Boolean, value: null, observer: '_onSelectionChange'},
      _showCorrectResponse: {type: Boolean, value: false},
      _viewModel: {type: Object, value: {}}
    },
    _onCorrectnessChange: function(n,o){
      console.log('c: ', n, o);
      this._updateViewModel(this.correctness, this.selection);
    },
    _onSelectionChange: function(n,o){
      console.log('s: ', n, o);
      this._updateViewModel(this.correctness, this.selection);
    },
    _updateViewModel: function(correctness, selection){
      var m = {
        selected: selection,
        correctness: correctness 
      }
      console.log('viewModel: ' , m);
      this._viewModel = m;
      this._onSelectedChange(this._viewModel.selected);
    },
    _toggleShowCorrectResponse: function(e, show){
      console.log(show);
      if(show){
        this._updateViewModel('correct', this.correctResponse.value);
      } else {
        this._updateViewModel(this.correctness, this.selection);
      }
    },
    _getClass: function(expected, selected, corr){
      this.updateStyles();
      if(selected === expected){
        return corr;        
      } else {
        return '';
      }
    },
    _falseClass: function(selected, correctness){
      return this._getClass(false, selected, correctness);
    },
    _trueClass: function(selected, correctness){
      return this._getClass(true, selected, correctness);
    },
    _onFalseChanged: function(e){
      var checked = e.target.attributes.getNamedItem('checked');
      this.selection = this.selection === false && checked === null ? null : false;
      this._onSelectedChange(this.selection);
    },
    _onTrueChanged: function(e){
      var checked = e.target.attributes.getNamedItem('checked');
      this.selection = this.selection === true && checked === null ? null : true;
      this._onSelectedChange(this.selection);
    },
    _onSelectedChange: function(s){
      this.$['false-button'].checked = s === false;
      this.$['true-button'].checked = s === true;
    },
    _onCorrectnessChange: function(c){
      //TODO: can i get rid of this?
      // setTimeout(this.updateStyles.bind(this), 0);
    }
  });
</script>