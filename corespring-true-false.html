<link rel="import" href="../polymer/polymer.html" />
<!--<link rel="import" href="../paper-styles/paper-styles.html" />-->
<link rel="import" href="../paper-styles/typography.html" />
<link rel="import" href="../paper-radio-button/paper-radio-button.html" />
<link rel="import" href="../corespring-show-correct-answer-toggle/corespring-show-correct-answer-toggle.html" />
<!-- 
`corespring-true-false` is a component that contains a prompt + 2 radio buttons: true and false. 

@demo demo/index.html
-->
<dom-module id="corespring-true-false">
  <template>
    <style>

    :host{
      @apply(--paper-font-common-base);
      display: block;

    }

    :host paper-radio-button {
      padding-left: 10px;
      flex: 0 0 auto;
    }

    paper-radio-button.correct {
      --paper-radio-button-checked-color: var(--paper-green-500);
      --paper-radio-button-checked-ink-color: var(--paper-green-500);
      --paper-radio-button-unchecked-color: var(--paper-green-900);
      --paper-radio-button-unchecked-ink-color: var(--paper-green-900);
      --paper-radio-button-label-color: var(--paper-green-500);
    }

    paper-radio-button.incorrect {
      --paper-radio-button-checked-color: var(--paper-red-500);
      --paper-radio-button-checked-ink-color: var(--paper-red-500);
      --paper-radio-button-unchecked-color: var(--paper-red-900);
      --paper-radio-button-unchecked-ink-color: var(--paper-red-900);
      --paper-radio-button-label-color: var(--paper-red-500);
    }

    .holder{
      height: 25px;
      display: flex;
      flex-direction: row;
    }

    corespring-show-correct-answer-toggle{
      display: inline-block;
      vertical-align: middle;
      padding-left: 10px;
      --show-correct-answer-height: 25px;
      @apply(--paper-font-common-base);
      flex: 1 0 auto;
    }

    </style>
    <div class="holder">
      <span>{{state.prompt}}</span>
      <paper-radio-button 
        id="true-button"
        on-change="_onTrueChanged"
        class$="{{_trueClass(_viewModel.selected, _viewModel.correctness)}}" 
        disabled="{{state.disabled}}"
        noink 
        >{{_trueLabel}}</paper-radio-button>
      <paper-radio-button 
        id="false-button"
        disabled="{{state.disabled}}"
        class$="{{_falseClass(_viewModel.selected, _viewModel.correctness)}}" 
        on-change="_onFalseChanged"
        noink 
        name="false" 
      >{{_falseLabel}}</paper-radio-button>
      <template is="dom-if" if="{{state.correctResponse}}">
          <corespring-show-correct-answer-toggle show-label="{{_showLabel}}" hide-label="{{_hideLabel}}" on-toggle="_toggleShowCorrectResponse"></corespring-show-correct-answer-toggle>
      </template>
    </div>
  </template>
</dom-module>
<script>

  Polymer({
    is: 'corespring-true-false',
    properties: {

      /**
       * The state of the component.
       * 
       * ```
       * {
       *   //are the radio buttons disabled
       *   disabled: true|false,
       *   //the prompt
       *   prompt: '...',
       *   //if present will show the 'show correct answer' button
       *   correctResponse: { value: true|false }
       * }
       * ```
       */
      state: {type: Object, value: {}, observer: '_onStateChanged'},
      /**
       * A user's interaction with the component.
       */
      session: {type:Object, value: {selected: null}, observer: '_onSessionChanged'},
      _showCorrectResponse: {type: Boolean, value: false},
      _viewModel: {type: Object, value: {}},
      _trueLabel: {type:String},
      _falseLabel: {type:String},
      _showLabel: {type:String},
      _hideLabel: {type:String}
    },
    observers: [
      '_onCorrectnessChange(state.correctness)',
      '_onSelectedChange(session.selected)'
    ],
    _onStateChanged: function(n,o){
      this.state.labels = this.state.labels || {};
      this._trueLabel = this.state.labels['true'] || 'true';
      this._falseLabel = this.state.labels['false'] || 'false';
      this._showLabel = this.state.labels.show || 'Show correct answer';
      this._hideLabel = this.state.labels.hide || 'Hide correct answer';

      this._updateViewModel(this.state, this.session);
    },
    _onSessionChanged: function(n,o){
      this._updateViewModel(this.state, this.session);
    },
    _updateViewModel: function(state, session){
      var m = {
        selected: session ? session.selected : null,
        correctness: state ? state.correctness : null
      }
      this._viewModel = m;
      this._onSelectedChange(this._viewModel.selected);
    },
    _toggleShowCorrectResponse: function(e, show){
      console.log(show);
      if(show){
        this._updateViewModel({correctness: 'correct'},
        {selected: this.state.correctResponse.value});
      } else {
        this._updateViewModel(this.state, this.session);
      }
    },
    _getClass: function(expected, selected, corr){
      this.updateStyles();
      if(selected === expected){
        return corr;        
      } else {
        return '';
      }
    },
    _falseClass: function(selected, correctness){
      return this._getClass(false, selected, correctness);
    },
    _trueClass: function(selected, correctness){
      return this._getClass(true, selected, correctness);
    },
    _onFalseChanged: function(e){
      var checked = e.target.attributes.getNamedItem('checked');
      this.session.selected = this.session.selected === false && checked === null ? null : false;
      this._onSelectedChange(this.session.selected);
    },
    _onTrueChanged: function(e){
      var checked = e.target.attributes.getNamedItem('checked');
      this.session.selected = this.session.selected === true && checked === null ? null : true;
      this._onSelectedChange(this.session.selected);
    },
    _onSelectedChange: function(s){
      this.$['false-button'].checked = s === false;
      this.$['true-button'].checked = s === true;
    },
    _onCorrectnessChange: function(c){
      //TODO: can i get rid of this?
      setTimeout(this.updateStyles.bind(this), 0);
    }
  });
</script>