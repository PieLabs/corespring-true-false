<link rel="import" href="../polymer/polymer.html" />
<link rel="import" href="../paper-radio-group/paper-radio-group.html" />
<link rel="import" href="../paper-radio-button/paper-radio-button.html" />
<link rel="import" href="../corespring-show-correct-answer-toggle/corespring-show-correct-answer-toggle.html" />
<!-- 
`corespring-true-false` is an experimental type of element.

It's '

-->
<dom-module id="corespring-true-false">
  <template>
    <style>

    :host paper-radio-button {
      padding-left: 10px;
    }

    paper-radio-button.correct {
      --paper-radio-button-checked-color: var(--paper-green-500);
      --paper-radio-button-checked-ink-color: var(--paper-green-500);
      --paper-radio-button-unchecked-color: var(--paper-green-900);
      --paper-radio-button-unchecked-ink-color: var(--paper-green-900);
      --paper-radio-button-label-color: var(--paper-green-500);
    }

    paper-radio-button.incorrect {
      --paper-radio-button-checked-color: var(--paper-red-500);
      --paper-radio-button-checked-ink-color: var(--paper-red-500);
      --paper-radio-button-unchecked-color: var(--paper-red-900);
      --paper-radio-button-unchecked-ink-color: var(--paper-red-900);
      --paper-radio-button-label-color: var(--paper-red-500);
    }

    .holder{
      height: 25px;
    }

    corespring-show-correct-answer-toggle{
      display: inline-block;
      vertical-align: middle;
      padding-left: 10px;
      --show-correct-answer-height: 25px;
    }

    </style>
    <div class="holder">
      <span>{{state.model.prompt}}</span>
      <paper-radio-button 
        id="true-button"
        on-change="onTrueChanged"
        class$="{{trueClass(viewModel.selected, viewModel.correctness)}}" 
        disabled="{{state.disabled}}"
        noink 
        >true</paper-radio-button>
      <paper-radio-button 
        id="false-button"
        disabled="{{state.disabled}}"
        class$="{{falseClass(viewModel.selected, viewModel.correctness)}}" 
        on-change="onFalseChanged"
        noink 
        name="false" 
      >false</paper-radio-button>
      <template is="dom-if" if="{{state.correctResponse}}">
          <corespring-show-correct-answer-toggle on-toggle="toggleShowCorrectResponse"></corespring-show-correct-answer-toggle>
      </template>
    </div>
  </template>
</dom-module>
<script>

  Polymer({
    is: 'corespring-true-false',
    properties: {
      state: {type: Object, value: { model: {}}, observer: 'onStateChanged'},
      session: {type:Object, value: {}, observer: 'onSessionChanged'},
      _showCorrectResponse: {type: Boolean, value: false},
      _viewModel: {type: Object, value: {}}
    },
    observers: [
      'onCorrectnessChange(state.correctness)',
      'onSelectedChange(session.selected)'
    ],
    onStateChanged: function(n,o){
      this.updateViewModel(this.state, this.session);
    },
    onSessionChanged: function(n,o){
      this.updateViewModel(this.state, this.session);
    },
    updateViewModel: function(state, session){
      console.log('updateViewModel');
      var m = {
        selected: session ? session.selected : null,
        correctness: state ? state.correctness : null
      }
      this.viewModel = m;
      this.onSelectedChange(this.viewModel.selected);
    },
    toggleShowCorrectResponse: function(e, show){
      console.log(show);
      if(show){
        this.updateViewModel({correctness: 'correct'},
        {selected: this.state.correctResponse.value});
      } else {
        this.updateViewModel(this.state, this.session);
      }
    },
    getClass: function(expected, selected, corr){
      this.updateStyles();
      if(selected === expected){
        return corr;        
      } else {
        return '';
      }
    },
    falseClass: function(selected, correctness){
      return this.getClass(false, selected, correctness);
    },
    trueClass: function(selected, correctness){
      return this.getClass(true, selected, correctness);
    },
    onFalseChanged: function(e){
      var checked = e.target.attributes.getNamedItem('checked');
      this.session.selected = this.session.selected === false && checked === null ? null : false;
      this.onSelectedChange(this.session.selected);
    },
    onTrueChanged: function(e){
      var checked = e.target.attributes.getNamedItem('checked');
      this.session.selected = this.session.selected === true && checked === null ? null : true;
      this.onSelectedChange(this.session.selected);
    },
    onSelectedChange: function(s){
      this.$['false-button'].checked = s === false;
      this.$['true-button'].checked = s === true;
    },
    onCorrectnessChange: function(c){
      setTimeout(this.updateStyles.bind(this), 0);
    }
  });
</script>